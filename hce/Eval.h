#pragma once
#include "../Typedefs.h"
namespace hce {
    constexpr int PHASE_PIECE_VALUES[5] = {4,2,1,1,0};
    constexpr const static eval_t MATE_VALUE = 1048576;
    constexpr uint64_t bishop_pair = 158913790051ULL;
    constexpr uint64_t passed_pawn_on_ranks[] = {0ULL, 281432027103200ULL, 281401962332143ULL, 281410552201238ULL, 85899345980ULL, 51539607700ULL, 579820585213ULL, 0ULL};
    constexpr uint64_t passed_pawn_on_file[] = {81604378684ULL, 77309411384ULL, 281457796841505ULL, 12884901902ULL, 281419142135827ULL, 8589934621ULL, 12884901950ULL, 38654705724ULL};
    constexpr uint64_t doubled_pawn = 281457796906993ULL;
    constexpr uint64_t isolated_pawn = 281376192528369ULL;
    constexpr uint64_t king_zone_attacks[] = {107374182420ULL, 171798757365ULL, 133144051703ULL, 94489346037ULL, 94489346028ULL};
    constexpr uint64_t mobility[] = {281470681743378ULL, 25769803782ULL, 30064771082ULL, 3ULL, 281436322070514ULL};
    constexpr uint64_t king_psts[] = {223338364830ULL, 339302481877ULL, 281264523378668ULL, 280972465602556ULL, 281045479981065ULL, 280804961812510ULL, 281006825275398ULL, 373662220146ULL, 438086729663ULL, 128849084414ULL, 281453501874188ULL, 281135674294304ULL, 281165739065396ULL, 270582939699ULL, 51539607597ULL, 481036402617ULL, 249108168677ULL, 12884901906ULL, 281152854163498ULL, 280989645406271ULL, 281084134686798ULL, 281303178018895ULL, 281273113247806ULL, 536870977491ULL, 281105609588733ULL, 281268818280482ULL, 281084134686781ULL, 280783486976087ULL, 280792076910690ULL, 281217278672990ULL, 433791696935ULL, 281346127691794ULL, 4295032803ULL, 281264523313192ULL, 281135674294330ULL, 280813551747154ULL, 280865091354719ULL, 4294967392ULL, 171798691906ULL, 281363307560965ULL, 281277408280572ULL, 281389077364762ULL, 281144264228906ULL, 281062659850296ULL, 281066954817619ULL, 476741369936ULL, 111669149783ULL, 206158430212ULL, 274877972432ULL, 201863528446ULL, 281367602528270ULL, 280968170569770ULL, 281049774948420ULL, 158913790035ULL, 300647710790ULL, 416611893243ULL, 240518234012ULL, 201863528417ULL, 281135674294279ULL, 280573033578530ULL, 280676112793642ULL, 281303178018854ULL, 281328947822623ULL, 601295486829ULL};
    constexpr uint64_t piece_type_psts[][64] = {
            {5669356832282ULL, 5686536701467ULL, 5639292061213ULL, 5677946766897ULL, 5604932322885ULL, 5725191407144ULL, 5660766897705ULL, 5493263173157ULL, 5669356832282ULL, 5729486374423ULL, 5699421603370ULL, 5613522257463ULL, 5677946766892ULL, 5708011537948ULL, 5523327944240ULL, 5437428598318ULL, 5759551145498ULL, 5793910883863ULL, 5716601472551ULL, 5643587028516ULL, 5656471930400ULL, 5716601472555ULL, 5531917878863ULL, 5574867551798ULL, 5815385720378ULL, 5823975654952ULL, 5703716570662ULL, 5716601472549ULL, 5634997093930ULL, 5703716570670ULL, 5471788336738ULL, 5746666243607ULL, 5785320949278ULL, 5811090753074ULL, 5729486374455ULL, 5725191407140ULL, 5686536701479ULL, 5755256178226ULL, 5420248729212ULL, 5686536701478ULL, 5682241734165ULL, 5884105197048ULL, 5729486374453ULL, 5682241734192ULL, 5699421603379ULL, 5914169968162ULL, 5682241734206ULL, 5729486374448ULL, 5819680687594ULL, 5901285066196ULL, 5768141080104ULL, 5725191407160ULL, 5733781341781ULL, 5974299510292ULL, 5617817224764ULL, 6025839117797ULL, 5781025981909ULL, 5965709575604ULL, 5729486374444ULL, 5733781341772ULL, 5716601472594ULL, 5884105197109ULL, 5957119641155ULL, 5660766897700ULL},
            {2512555869129ULL, 2375116915657ULL, 2353642079188ULL, 2357937046491ULL, 2448131359714ULL, 2503965934557ULL, 2546915607523ULL, 2598455215072ULL, 2521145803722ULL, 2430951490510ULL, 2366526981072ULL, 2349347111901ULL, 2508260901850ULL, 2641404888028ULL, 2486786065397ULL, 2461016261614ULL, 2602750182352ULL, 2551210574796ULL, 2439541425103ULL, 2409476654045ULL, 2499670967269ULL, 2611340116958ULL, 2598455215099ULL, 2435246457853ULL, 2649994822600ULL, 2546915607502ULL, 2461016261587ULL, 2465311228887ULL, 2551210574812ULL, 2607045149656ULL, 2701534430189ULL, 2409476654072ULL, 2671469659072ULL, 2581275345858ULL, 2495375999945ULL, 2503965934545ULL, 2555505542089ULL, 2813203579845ULL, 2594160247791ULL, 2473901163503ULL, 2628519986113ULL, 2585570313143ULL, 2448131359678ULL, 2349347111891ULL, 2581275345861ULL, 2757369004995ULL, 2740189135837ULL, 2607045149670ULL, 2662879724469ULL, 2675764626344ULL, 2611340116897ULL, 2499670967235ULL, 2624225018821ULL, 3049426781112ULL, 2714419332054ULL, 2594160247782ULL, 2525440770998ULL, 2469606196148ULL, 2512555869098ULL, 2443836392385ULL, 2637109920703ULL, 2847563318198ULL, 2916282794949ULL, 2791728743383ULL},
            {1842540970482ULL, 1915555414540ULL, 1868310774281ULL, 1851130905099ULL, 1846835937808ULL, 1906965479957ULL, 1799591297534ULL, 1726576853518ULL, 1997159793162ULL, 1984274891258ULL, 1902670512654ULL, 1821066134036ULL, 1928440316434ULL, 2027224564231ULL, 1919850381826ULL, 1571958030876ULL, 1924145349118ULL, 2005749727735ULL, 1949915152911ULL, 1864015806998ULL, 1949915152908ULL, 1988569858568ULL, 1864015806985ULL, 1554778161684ULL, 1872605741575ULL, 1894080578062ULL, 1928440316435ULL, 2027224564238ULL, 2022929596951ULL, 2018634629629ULL, 1769526526477ULL, 1301375091238ULL, 1898375545350ULL, 1975684956682ULL, 1954210120215ULL, 1997159793161ULL, 2010044695046ULL, 1932735283716ULL, 1872605741568ULL, 1361504633376ULL, 1885490643470ULL, 2040109466111ULL, 1962800054796ULL, 1898375545355ULL, 1971389989390ULL, 2151778615816ULL, 1855425872388ULL, 1438814044690ULL, 1979979923954ULL, 2100239008257ULL, 1924145349122ULL, 1864015806989ULL, 1924145349130ULL, 2048699400713ULL, 1778116461068ULL, 1649267442193ULL, 1941325218263ULL, 1967095022062ULL, 1992864825849ULL, 1915555414522ULL, 1803886264851ULL, 1949915152921ULL, 1799591297530ULL, 1494648619525ULL},
            {1382979469821ULL, 1687922147848ULL, 1739461755402ULL, 1868310774307ULL, 1949915152934ULL, 1941325218323ULL, 1812476199427ULL, 949187772850ULL, 1782411428335ULL, 1756641624603ULL, 1889785610788ULL, 1971389989426ULL, 2048699400764ULL, 2207613190692ULL, 1945620185630ULL, 1142461301252ULL, 1735166788114ULL, 1881195676201ULL, 2014339662378ULL, 2113123910220ULL, 2203318223435ULL, 2332167242298ULL, 2138893713955ULL, 1563368096291ULL, 1846835937811ULL, 1992864825898ULL, 2078764171849ULL, 2121713844813ULL, 2375116915277ULL, 2327872275009ULL, 2233382994473ULL, 1743756722709ULL, 1851130905113ULL, 1992864825896ULL, 2147483648576ULL, 2207613190739ULL, 2143188681302ULL, 2525440770605ULL, 2074469204514ULL, 1979979923994ULL, 1928440316418ULL, 2018634629662ULL, 2052994368034ULL, 2121713844799ULL, 2345052144205ULL, 2589865280029ULL, 2478196130310ULL, 1589137900024ULL, 1808181232120ULL, 1881195676169ULL, 2010044695063ULL, 2095944041007ULL, 2010044695113ULL, 2276332667423ULL, 1932735283736ULL, 1335734829577ULL, 1571958030836ULL, 1864015806994ULL, 1859720839693ULL, 1932735283733ULL, 2138893713947ULL, 2083059139081ULL, 2052994367979ULL, 1245540516241ULL},
            {0ULL, 347892351154ULL, 330712481960ULL, 335007449268ULL, 399431958736ULL, 523986010353ULL, 356482285773ULL, 0ULL, 0ULL, 433791697093ULL, 399431958714ULL, 455266533572ULL, 519691043028ULL, 605590388999ULL, 502511173832ULL, 0ULL, 0ULL, 476741370060ULL, 506806141116ULL, 549755814078ULL, 609885356235ULL, 854698492125ULL, 481036337377ULL, 0ULL, 0ULL, 446676598993ULL, 523986010312ULL, 648540061883ULL, 639950127290ULL, 824633721015ULL, 691489734814ULL, 0ULL, 0ULL, 545460846812ULL, 601295421639ULL, 670014898363ULL, 773094113464ULL, 884763263154ULL, 558345748640ULL, 0ULL, 0ULL, 704374636739ULL, 588410519742ULL, 627065225405ULL, 734439407807ULL, 1095216660677ULL, 369367187628ULL, 0ULL, 0ULL, 751619276972ULL, 631360192680ULL, 575525617846ULL, 682899800261ULL, 889058230503ULL, 281268818280657ULL, 0ULL, 0ULL, 481036337302ULL, 523986010257ULL, 481036337307ULL, 584115552430ULL, 639950127323ULL, 281135674294489ULL, 0ULL},
    };



    [[nodiscard]] inline packed_eval_t getPassedPawnOnSquareBonus(const int square) {
        return passed_pawn_on_ranks[square & 7] + passed_pawn_on_file[square >> 3];
    }


    [[nodiscard]] inline eval_t getEvalFromPacked (packed_eval_t packed, int phase) { // higher phase means closer to mg
        int mg = int(int16_t(packed >> 32 & 0xffff));
        int eg = int(int16_t(packed & 0xffff));
        return float(mg * phase + eg * (24 - phase)) / 24.0F;
    }
}

namespace pawn_eval {
    constexpr const static bitboard_t WHITE_PAWN_STOPPING_SQUARES[64] = {65278ULL, 64764ULL, 63736ULL, 61680ULL, 57568ULL, 49344ULL, 32896ULL, 0ULL, 16711422ULL, 16579836ULL, 16316664ULL, 15790320ULL, 14737632ULL, 12632256ULL, 8421504ULL, 0ULL, 4278124032ULL, 4244438016ULL, 4177065984ULL, 4042321920ULL, 3772833792ULL, 3233857536ULL, 2155905024ULL, 0ULL, 1095199752192ULL, 1086576132096ULL, 1069328891904ULL, 1034834411520ULL, 965845450752ULL, 827867529216ULL, 551911686144ULL, 0ULL, 280371136561152ULL, 278163489816576ULL, 273748196327424ULL, 264917609349120ULL, 247256435392512ULL, 211934087479296ULL, 141289391652864ULL, 0ULL, 71775010959654912ULL, 71209853393043456ULL, 70079538259820544ULL, 67818907993374720ULL, 63297647460483072ULL, 54255126394699776ULL, 36170084263133184ULL, 0ULL, 18374402805671657472ULL, 18229722468619124736ULL, 17940361794514059264ULL, 17361640446303928320ULL, 16204197749883666432ULL, 13889312357043142656ULL, 9259541571362095104ULL, 0ULL, 18374123529718202368ULL, 18229445391688925184ULL, 17940089115630370816ULL, 17361376563513262080ULL, 16203951459279044608ULL, 13889101250810609664ULL, 9259400833873739776ULL, 0ULL};
    constexpr const static bitboard_t BLACK_PAWN_STOPPING_SQUARES[64] = {0ULL, 257ULL, 771ULL, 1799ULL, 3855ULL, 7967ULL, 16191ULL, 32639ULL, 0ULL, 65793ULL, 197379ULL, 460551ULL, 986895ULL, 2039583ULL, 4144959ULL, 8355711ULL, 0ULL, 16843008ULL, 50529024ULL, 117901056ULL, 252645120ULL, 522133248ULL, 1061109504ULL, 2139062016ULL, 0ULL, 4311810048ULL, 12935430144ULL, 30182670336ULL, 64677150720ULL, 133666111488ULL, 271644033024ULL, 547599876096ULL, 0ULL, 1103823372288ULL, 3311470116864ULL, 7726763606016ULL, 16557350584320ULL, 34218524540928ULL, 69540872454144ULL, 140185568280576ULL, 0ULL, 282578783305728ULL, 847736349917184ULL, 1978051483140096ULL, 4238681749585920ULL, 8759942282477568ULL, 17802463348260864ULL, 35887505479827456ULL, 0ULL, 72340168526266368ULL, 217020505578799104ULL, 506381179683864576ULL, 1085102527893995520ULL, 2242545224314257408ULL, 4557430617154781184ULL, 9187201402835828736ULL, 0ULL, 72339069014638592ULL, 217017207043915776ULL, 506373483102470144ULL, 1085086035219578880ULL, 2242511139453796352ULL, 4557361347922231296ULL, 9187061764859101184ULL};
    constexpr const static bitboard_t PAWN_NEIGHBOR_FILES[8] = {65280ULL,16711935ULL,4278255360ULL,1095233372160ULL,280379743272960ULL,71777214277877760ULL,18374966855136706560ULL,71776119061217280ULL};


    [[nodiscard]] inline bool isThisWhitePawnPassed (const int square, const bitboard_t blackPawns) {
        return (blackPawns & WHITE_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }
    [[nodiscard]] inline bool isThisBlackPawnPassed (const int square, const bitboard_t whitePawns) {
        return (whitePawns & BLACK_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnIsolated (const int square, const bitboard_t friendlyPawns) {
        return (friendlyPawns & PAWN_NEIGHBOR_FILES[square >> 3]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnDoubled (const int square, const bitboard_t friendlyPawns) {
        return (~(1ULL << square) & friendlyPawns & 255ULL << (square & 56)) != 0ULL;
    }
}