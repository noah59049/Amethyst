#pragma once
#include "../Typedefs.h"
namespace hce {
    constexpr int PHASE_PIECE_VALUES[5] = {4,2,1,1,0};
    constexpr const static eval_t MATE_VALUE = 31000;
    constexpr uint64_t bishop_pair = 154618822755ULL;
    constexpr uint64_t passed_pawn_on_ranks[] = {0ULL, 281444912005091ULL, 281410552266740ULL, 281414847168538ULL, 81604378687ULL, 42949673112ULL, 566935683324ULL, 0ULL};
    constexpr uint64_t passed_pawn_on_file[] = {81604378686ULL, 77309411389ULL, 281462091808806ULL, 17179869200ULL, 281427732070421ULL, 12884901923ULL, 34359738435ULL, 47244640317ULL};
    constexpr uint64_t isolated_pawn = 281363307626476ULL;
    constexpr uint64_t king_shelter = 103079215105ULL;
    constexpr uint64_t king_zone_attacks[] = {90194313236ULL, 154618888181ULL, 120259149815ULL, 85899411445ULL, 77309476844ULL};
    constexpr uint64_t mobility[] = {18ULL, 21474836486ULL, 30064771082ULL, 4ULL, 281440617037809ULL};
    constexpr uint64_t king_psts[] = {296352808857ULL, 390842089424ULL, 281346127757290ULL, 281058364948475ULL, 281109904490505ULL, 280877976256542ULL, 281066954817543ULL, 446676664180ULL, 395137056700ULL, 90194378749ULL, 281453501874186ULL, 281161444098079ULL, 281204393771060ULL, 287762808885ULL, 107374182445ULL, 541165944762ULL, 146028953581ULL, 281432027037716ULL, 281144264228905ULL, 281011120242751ULL, 281092724621391ULL, 281337537757264ULL, 281324652855359ULL, 609885421523ULL, 281092724621313ULL, 281204393771045ULL, 281041185013821ULL, 280774897041496ULL, 280792076910692ULL, 281251638411359ULL, 498216206374ULL, 281414847168530ULL, 281449206972393ULL, 281208688738345ULL, 281101314555962ULL, 280796371877971ULL, 280882271223905ULL, 47244640353ULL, 214748364866ULL, 281440616972292ULL, 281251638476798ULL, 281328947822619ULL, 281109904490538ULL, 281075544752183ULL, 281092724621396ULL, 515396075601ULL, 154618822745ULL, 261993005060ULL, 240518234063ULL, 188978626553ULL, 281354717626380ULL, 280998235340841ULL, 281084134686788ULL, 206158430292ULL, 356482285639ULL, 455266598909ULL, 365072285585ULL, 304942743512ULL, 281221573640195ULL, 280676112793631ULL, 280766307106858ULL, 281384782397479ULL, 281397667299360ULL, 648540127087ULL};
    constexpr uint64_t piece_type_psts[][64] = {
            {5677946766875ULL, 5699421603357ULL, 5656471930396ULL, 5690831668786ULL, 5617817224774ULL, 5738076309034ULL, 5686536701481ULL, 5531917878821ULL, 5673651799579ULL, 5733781341721ULL, 5703716570669ULL, 5630702126647ULL, 5695126636076ULL, 5716601472542ULL, 5549097748017ULL, 5484673238573ULL, 5759551145500ULL, 5798205851162ULL, 5720896439848ULL, 5660766897702ULL, 5686536701472ULL, 5738076309035ULL, 5570572584528ULL, 5630702126644ULL, 5802500818494ULL, 5806795785775ULL, 5699421603370ULL, 5733781341734ULL, 5669356832299ULL, 5738076309040ULL, 5510443042403ULL, 5815385720341ULL, 5785320949278ULL, 5806795785780ULL, 5729486374456ULL, 5746666243618ULL, 5712306505257ULL, 5802500818485ULL, 5471788336764ULL, 5755256178213ULL, 5622112192026ULL, 5823975654908ULL, 5660766897721ULL, 5699421603375ULL, 5729486374452ULL, 5961414608417ULL, 5793910883900ULL, 5815385720364ULL, 5750961210864ULL, 5841155524055ULL, 5712306505253ULL, 5742371276341ULL, 5750961210967ULL, 6021544150547ULL, 5733781341747ULL, 6111738463713ULL, 5750961210842ULL, 5918464935350ULL, 5660766897714ULL, 5755256178249ULL, 5742371276371ULL, 5918464935478ULL, 6051608921659ULL, 5750961210909ULL},
            {2534030705609ULL, 2396591752137ULL, 2375116915668ULL, 2379411882970ULL, 2473901163489ULL, 2529735738333ULL, 2589865280482ULL, 2654289789918ULL, 2542620640201ULL, 2452426326989ULL, 2388001817551ULL, 2375116915676ULL, 2534030705626ULL, 2671469659099ULL, 2529735738356ULL, 2525440771051ULL, 2624225018831ULL, 2572685411275ULL, 2456721294285ULL, 2435246457819ULL, 2538325672931ULL, 2645699855325ULL, 2654289789945ULL, 2512555869177ULL, 2658584757194ULL, 2559800509390ULL, 2478196130770ULL, 2508260901845ULL, 2598455215066ULL, 2658584757207ULL, 2765958939628ULL, 2503965934580ULL, 2692944495552ULL, 2598455215041ULL, 2521145803719ULL, 2529735738320ULL, 2594160247751ULL, 2856153252804ULL, 2658584757229ULL, 2572685411307ULL, 2568390443971ULL, 2534030705594ULL, 2405181686719ULL, 2379411882960ULL, 2607045149635ULL, 2800318677953ULL, 2843268350937ULL, 2723009266658ULL, 2632814953399ULL, 2637109920682ULL, 2559800509346ULL, 2508260901825ULL, 2637109920708ULL, 3075196584888ULL, 2765958939606ULL, 2675764626404ULL, 2529735738299ULL, 2452426326966ULL, 2465311228845ULL, 2439541425089ULL, 2637109920704ULL, 2847563318200ULL, 2959232467909ULL, 2856153252822ULL},
            {1846835937778ULL, 1915555414539ULL, 1868310774279ULL, 1855425872394ULL, 1846835937808ULL, 1906965479957ULL, 1799591297533ULL, 1722281886222ULL, 1988569858570ULL, 1979979923961ULL, 1902670512653ULL, 1825361101330ULL, 1937030251024ULL, 2031519531526ULL, 1924145349121ULL, 1580547965467ULL, 1924145349116ULL, 2001454760437ULL, 1945620185613ULL, 1872605741588ULL, 1962800054794ULL, 1997159793159ULL, 1868310774280ULL, 1554778161683ULL, 1859720839687ULL, 1876900708877ULL, 1911260447248ULL, 2035814498828ULL, 2048699400724ULL, 2031519531515ULL, 1782411428363ULL, 1301375091237ULL, 1902670512645ULL, 1962800054793ULL, 1945620185620ULL, 2001454760454ULL, 2022929596933ULL, 1949915152898ULL, 1894080578046ULL, 1382979469855ULL, 1825361101330ULL, 1967095022080ULL, 1881195676172ULL, 1898375545352ULL, 1975684956684ULL, 2173253452295ULL, 1902670512642ULL, 1438814044689ULL, 1911260447219ULL, 2027224564225ULL, 1855425872385ULL, 1859720839690ULL, 1928440316424ULL, 2065879269895ULL, 1808181232138ULL, 1675037245968ULL, 1872605741530ULL, 1894080578031ULL, 1924145349114ULL, 1915555414520ULL, 1816771166737ULL, 1954210120216ULL, 1808181232122ULL, 1524713390596ULL},
            {1382979469822ULL, 1687922147847ULL, 1743756722697ULL, 1872605741602ULL, 1954210120229ULL, 1945620185618ULL, 1799591297539ULL, 936302870963ULL, 1778116461041ULL, 1756641624602ULL, 1881195676194ULL, 1971389989424ULL, 2057289335356ULL, 2216203125283ULL, 1954210120221ULL, 1146756268547ULL, 1726576853522ULL, 1885490643495ULL, 2010044695079ULL, 2113123910218ULL, 2211908158025ULL, 2336462209593ULL, 2147483648547ULL, 1571958030881ULL, 1833951035924ULL, 1979979924009ULL, 2070174237254ULL, 2130303779402ULL, 2383706849867ULL, 2345052144190ULL, 2250562863655ULL, 1752346657301ULL, 1859720839702ULL, 1979979924006ULL, 2138893713981ULL, 2207613190737ULL, 2164663517780ULL, 2542620639788ULL, 2070174237218ULL, 1997159793177ULL, 1846835937798ULL, 1941325218336ULL, 1967095022115ULL, 2121713844795ULL, 2357937046091ULL, 2615635083803ULL, 2503965934085ULL, 1602022801911ULL, 1803886264826ULL, 1812476199433ULL, 1932735283733ULL, 2100239008300ULL, 2027224564295ULL, 2293512536606ULL, 1937030251033ULL, 1352914698762ULL, 1498943586806ULL, 1791001362963ULL, 1799591297551ULL, 1932735283731ULL, 2138893713947ULL, 2074469204490ULL, 2074469204459ULL, 1262720385424ULL},
            {0ULL, 343597383856ULL, 326417514661ULL, 330712481968ULL, 395136991436ULL, 519691043054ULL, 356482285774ULL, 0ULL, 0ULL, 416611827900ULL, 377957122224ULL, 438086664379ULL, 502511173835ULL, 588410519807ULL, 476741370053ULL, 0ULL, 0ULL, 459561500867ULL, 489626271924ULL, 541165879479ULL, 597000454340ULL, 837518622933ULL, 476741370078ULL, 0ULL, 0ULL, 412316860620ULL, 498216206531ULL, 644245094583ULL, 622770258101ULL, 820338753714ULL, 700079669407ULL, 0ULL, 0ULL, 523986010326ULL, 575525617856ULL, 661424963765ULL, 764504178866ULL, 884763263147ULL, 579820585118ULL, 0ULL, 0ULL, 609885356221ULL, 493921239223ULL, 609885356211ULL, 717259538613ULL, 1086626726074ULL, 360777253030ULL, 0ULL, 0ULL, 670014898339ULL, 545460846751ULL, 545460846764ULL, 644245094587ULL, 854698492124ULL, 281217278673101ULL, 0ULL, 0ULL, 412316860565ULL, 455266533520ULL, 455266533528ULL, 562640715947ULL, 609885356248ULL, 281092724621534ULL, 0ULL},
    };



    [[nodiscard]] inline packed_eval_t getPassedPawnOnSquareBonus(const int square) {
        return passed_pawn_on_ranks[square & 7] + passed_pawn_on_file[square >> 3];
    }


    [[nodiscard]] inline eval_t getEvalFromPacked (packed_eval_t packed, int phase) { // higher phase means closer to mg
        int mg = int(int16_t(packed >> 32 & 0xffff));
        int eg = int(int16_t(packed & 0xffff));
        return eval_t((mg * phase + eg * (24 - phase)) / 24);
    }
}

namespace pawn_eval {
    constexpr const static bitboard_t WHITE_PAWN_STOPPING_SQUARES[64] = {65278ULL, 64764ULL, 63736ULL, 61680ULL, 57568ULL, 49344ULL, 32896ULL, 0ULL, 16711422ULL, 16579836ULL, 16316664ULL, 15790320ULL, 14737632ULL, 12632256ULL, 8421504ULL, 0ULL, 4278124032ULL, 4244438016ULL, 4177065984ULL, 4042321920ULL, 3772833792ULL, 3233857536ULL, 2155905024ULL, 0ULL, 1095199752192ULL, 1086576132096ULL, 1069328891904ULL, 1034834411520ULL, 965845450752ULL, 827867529216ULL, 551911686144ULL, 0ULL, 280371136561152ULL, 278163489816576ULL, 273748196327424ULL, 264917609349120ULL, 247256435392512ULL, 211934087479296ULL, 141289391652864ULL, 0ULL, 71775010959654912ULL, 71209853393043456ULL, 70079538259820544ULL, 67818907993374720ULL, 63297647460483072ULL, 54255126394699776ULL, 36170084263133184ULL, 0ULL, 18374402805671657472ULL, 18229722468619124736ULL, 17940361794514059264ULL, 17361640446303928320ULL, 16204197749883666432ULL, 13889312357043142656ULL, 9259541571362095104ULL, 0ULL, 18374123529718202368ULL, 18229445391688925184ULL, 17940089115630370816ULL, 17361376563513262080ULL, 16203951459279044608ULL, 13889101250810609664ULL, 9259400833873739776ULL, 0ULL};
    constexpr const static bitboard_t BLACK_PAWN_STOPPING_SQUARES[64] = {0ULL, 257ULL, 771ULL, 1799ULL, 3855ULL, 7967ULL, 16191ULL, 32639ULL, 0ULL, 65793ULL, 197379ULL, 460551ULL, 986895ULL, 2039583ULL, 4144959ULL, 8355711ULL, 0ULL, 16843008ULL, 50529024ULL, 117901056ULL, 252645120ULL, 522133248ULL, 1061109504ULL, 2139062016ULL, 0ULL, 4311810048ULL, 12935430144ULL, 30182670336ULL, 64677150720ULL, 133666111488ULL, 271644033024ULL, 547599876096ULL, 0ULL, 1103823372288ULL, 3311470116864ULL, 7726763606016ULL, 16557350584320ULL, 34218524540928ULL, 69540872454144ULL, 140185568280576ULL, 0ULL, 282578783305728ULL, 847736349917184ULL, 1978051483140096ULL, 4238681749585920ULL, 8759942282477568ULL, 17802463348260864ULL, 35887505479827456ULL, 0ULL, 72340168526266368ULL, 217020505578799104ULL, 506381179683864576ULL, 1085102527893995520ULL, 2242545224314257408ULL, 4557430617154781184ULL, 9187201402835828736ULL, 0ULL, 72339069014638592ULL, 217017207043915776ULL, 506373483102470144ULL, 1085086035219578880ULL, 2242511139453796352ULL, 4557361347922231296ULL, 9187061764859101184ULL};
    constexpr const static bitboard_t PAWN_NEIGHBOR_FILES[8] = {65280ULL,16711935ULL,4278255360ULL,1095233372160ULL,280379743272960ULL,71777214277877760ULL,18374966855136706560ULL,71776119061217280ULL};


    [[nodiscard]] inline bool isThisWhitePawnPassed (const int square, const bitboard_t blackPawns) {
        return (blackPawns & WHITE_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }
    [[nodiscard]] inline bool isThisBlackPawnPassed (const int square, const bitboard_t whitePawns) {
        return (whitePawns & BLACK_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnIsolated (const int square, const bitboard_t friendlyPawns) {
        return (friendlyPawns & PAWN_NEIGHBOR_FILES[square >> 3]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnDoubled (const int square, const int friendlyPawns) {
        return (~(1ULL << square) & friendlyPawns & 255ULL << (square & 56)) != 0ULL;
    }
}

namespace kingsafety {
    // shield zones are the row with the king on them, plus the two rows in front.
    // And only on the king's file or neighboring files
    // the idea is that a pawn or piece in that zone counts as defending the king.
    constexpr const static bitboard_t WHITE_SHIELD_ZONES[64] = {1799ULL,3598ULL,7196ULL,14392ULL,28784ULL,57568ULL,49344ULL,32896ULL,460551ULL,921102ULL,1842204ULL,3684408ULL,7368816ULL,14737632ULL,12632256ULL,8421504ULL,117901056ULL,235802112ULL,471604224ULL,943208448ULL,1886416896ULL,3772833792ULL,3233857536ULL,2155905024ULL,30182670336ULL,60365340672ULL,120730681344ULL,241461362688ULL,482922725376ULL,965845450752ULL,827867529216ULL,551911686144ULL,7726763606016ULL,15453527212032ULL,30907054424064ULL,61814108848128ULL,123628217696256ULL,247256435392512ULL,211934087479296ULL,141289391652864ULL,1978051483140096ULL,3956102966280192ULL,7912205932560384ULL,15824411865120768ULL,31648823730241536ULL,63297647460483072ULL,54255126394699776ULL,36170084263133184ULL,506381179683864576ULL,1012762359367729152ULL,2025524718735458304ULL,4051049437470916608ULL,8102098874941833216ULL,16204197749883666432ULL,13889312357043142656ULL,9259541571362095104ULL,506373483102470144ULL,1012746966204940288ULL,2025493932409880576ULL,4050987864819761152ULL,8101975729639522304ULL,16203951459279044608ULL,13889101250810609664ULL,9259400833873739776ULL};
    constexpr const static bitboard_t BLACK_SHIELD_ZONES[64] = {257ULL, 771ULL, 1799ULL, 3598ULL, 7196ULL, 14392ULL, 28784ULL, 57568ULL, 65793ULL, 197379ULL, 460551ULL, 921102ULL, 1842204ULL, 3684408ULL, 7368816ULL, 14737632ULL, 16843008ULL, 50529024ULL, 117901056ULL, 235802112ULL, 471604224ULL, 943208448ULL, 1886416896ULL, 3772833792ULL, 4311810048ULL, 12935430144ULL, 30182670336ULL, 60365340672ULL, 120730681344ULL, 241461362688ULL, 482922725376ULL, 965845450752ULL, 1103823372288ULL, 3311470116864ULL, 7726763606016ULL, 15453527212032ULL, 30907054424064ULL, 61814108848128ULL, 123628217696256ULL, 247256435392512ULL, 282578783305728ULL, 847736349917184ULL, 1978051483140096ULL, 3956102966280192ULL, 7912205932560384ULL, 15824411865120768ULL, 31648823730241536ULL, 63297647460483072ULL, 72340168526266368ULL, 217020505578799104ULL, 506381179683864576ULL, 1012762359367729152ULL, 2025524718735458304ULL, 4051049437470916608ULL, 8102098874941833216ULL, 16204197749883666432ULL, 72339069014638592ULL, 217017207043915776ULL, 506373483102470144ULL, 1012746966204940288ULL, 2025493932409880576ULL, 4050987864819761152ULL, 8101975729639522304ULL, 16203951459279044608ULL};
}