#pragma once
#include "../Typedefs.h"
namespace hce {
    constexpr int PHASE_PIECE_VALUES[5] = {4,2,1,1,0};
    constexpr const static eval_t MATE_VALUE = 1048576;
    constexpr uint64_t bishop_pair = 154618822755ULL;
    constexpr uint64_t passed_pawn_on_ranks[] = {0ULL, 281436322070498ULL, 281406257299443ULL, 281410552201240ULL, 81604378687ULL, 38654705817ULL, 597000454403ULL, 0ULL};
    constexpr uint64_t passed_pawn_on_file[] = {81604378685ULL, 77309411387ULL, 281462091808805ULL, 21474836497ULL, 281419142135831ULL, 36ULL, 4294967361ULL, 34359738429ULL};
    constexpr uint64_t white_to_move = 137438953507ULL;
    constexpr uint64_t isolated_pawn = 281367602593771ULL;
    constexpr uint64_t king_zone_attacks[] = {107374182416ULL, 171798757362ULL, 128849084407ULL, 98784313331ULL, 94489346029ULL};
    constexpr uint64_t mobility[] = {281470681743379ULL, 25769803782ULL, 30064771082ULL, 281470681743363ULL, 281436322070514ULL};
    constexpr uint64_t king_psts[] = {244813201312ULL, 347892416470ULL, 281273113313264ULL, 280972465537024ULL, 281011120242703ULL, 280774897041447ULL, 281036890046477ULL, 373662220157ULL, 442381696959ULL, 128849084414ULL, 281462091808780ULL, 281144264228897ULL, 281152854163512ULL, 210453397563ULL, 34359738422ULL, 545460912064ULL, 231928299492ULL, 25769803793ULL, 281161444098088ULL, 280998235340864ULL, 281066954817617ULL, 281294588084308ULL, 281268818280515ULL, 592705552342ULL, 281109904556030ULL, 281273113247777ULL, 281101314555963ULL, 280817846714454ULL, 280804961812580ULL, 281208688738402ULL, 446676598825ULL, 281397667299347ULL, 281457796906978ULL, 281273113247782ULL, 281161444098104ULL, 280843616518226ULL, 280890861158498ULL, 8589934696ULL, 150323855431ULL, 281389077364743ULL, 281294588149754ULL, 281401962266647ULL, 281157149130792ULL, 281084134686776ULL, 281075544752215ULL, 493921239127ULL, 124554051677ULL, 193273528328ULL, 270583005134ULL, 210453463035ULL, 281384782397452ULL, 280972465537068ULL, 281049774948425ULL, 85899346014ULL, 223338299471ULL, 390842089469ULL, 257698103193ULL, 214748430301ULL, 281161444098052ULL, 280581623513123ULL, 280646048022577ULL, 281281703182381ULL, 281230163574823ULL, 584115617649ULL};
    constexpr uint64_t piece_type_psts[][64] = {
            {5733781341740ULL, 5759551145514ULL, 5712306505264ULL, 5738076309064ULL, 5695126636130ULL, 5806795785802ULL, 5763846112840ULL, 5566277617207ULL, 5746666243625ULL, 5802500818470ULL, 5755256178236ULL, 5699421603404ULL, 5755256178246ULL, 5806795785785ULL, 5643587028555ULL, 5523327944253ULL, 5828270622251ULL, 5849745458728ULL, 5781025982011ULL, 5716601472567ULL, 5746666243642ULL, 5815385720388ULL, 5656471930468ULL, 5656471930436ULL, 5849745458764ULL, 5875515262524ULL, 5755256178234ULL, 5785320949309ULL, 5729486374466ULL, 5802500818503ULL, 5600637355636ULL, 5832565589538ULL, 5845450491441ULL, 5858335393348ULL, 5793910883914ULL, 5811090753078ULL, 5776731014718ULL, 5815385720399ULL, 5540507813521ULL, 5798205851184ULL, 5738076309033ULL, 5944234739212ULL, 5776731014732ULL, 5746666243654ULL, 5772436047436ULL, 6012954215998ULL, 5789615916635ULL, 5811090753092ULL, 5896990098939ULL, 5961414608360ULL, 5823975654973ULL, 5789615916621ULL, 5798205851247ULL, 6043018987061ULL, 5750961210965ULL, 6085968659960ULL, 5854040425959ULL, 6043018986946ULL, 5789615916610ULL, 5798205851234ULL, 5781025982064ULL, 5952824673876ULL, 6043018987105ULL, 5703716570684ULL},
            {2521145803735ULL, 2418066588636ULL, 2396591752169ULL, 2409476654067ULL, 2503965934588ULL, 2568390444023ULL, 2615635084283ULL, 2645699855350ULL, 2555505542107ULL, 2473901163488ULL, 2413771621348ULL, 2409476654067ULL, 2555505542132ULL, 2697239462901ULL, 2555505542158ULL, 2516850836483ULL, 2628519986145ULL, 2594160247775ULL, 2478196130787ULL, 2465311228915ULL, 2551210574845ULL, 2680059593718ULL, 2667174691859ULL, 2495376000015ULL, 2671469659097ULL, 2589865280480ULL, 2503965934567ULL, 2529735738349ULL, 2619930051573ULL, 2671469659119ULL, 2765958939652ULL, 2469606196234ULL, 2697239462865ULL, 2619930051540ULL, 2538325672924ULL, 2559800509416ULL, 2615635084258ULL, 2886218023903ULL, 2645699855367ULL, 2525440771072ULL, 2637109920721ULL, 2615635084234ULL, 2473901163475ULL, 2383706850283ULL, 2615635084258ULL, 2808908612574ULL, 2804613645304ULL, 2637109920767ULL, 2688649528260ULL, 2701534430140ULL, 2641404887988ULL, 2534030705627ULL, 2645699855330ULL, 3092376454101ULL, 2744484103155ULL, 2607045149694ULL, 2529735738307ULL, 2512555869127ULL, 2542620640191ULL, 2473901163482ULL, 2667174691805ULL, 2890512991187ULL, 2959232467937ULL, 2813203579886ULL},
            {1885490643456ULL, 1945620185622ULL, 1906965479953ULL, 1898375545365ULL, 1906965479964ULL, 1962800054819ULL, 1898375545356ULL, 1760936591903ULL, 2031519531546ULL, 2014339662338ULL, 1937030251033ULL, 1876900708892ULL, 1971389989404ULL, 2083059139090ULL, 2035814498830ULL, 1627792605736ULL, 1941325218310ULL, 2044404433408ULL, 1988569858584ULL, 1894080578080ULL, 2018634629654ULL, 2057289335315ULL, 1954210120212ULL, 1602022801953ULL, 1915555414545ULL, 1924145349143ULL, 1949915152924ULL, 2083059139096ULL, 2087354106402ULL, 2087354106373ULL, 1838246003225ULL, 1344324764209ULL, 1945620185616ULL, 2001454760467ULL, 1979979923999ULL, 2052994368019ULL, 2078764171793ULL, 1979979923983ULL, 1971389989387ULL, 1404454306348ULL, 1906965479959ULL, 2078764171784ULL, 1997159793174ULL, 1924145349140ULL, 2027224564249ULL, 2224793059860ULL, 1906965479955ULL, 1447403979294ULL, 2022929596925ULL, 2126008812043ULL, 1967095022090ULL, 1915555414551ULL, 1962800054805ULL, 2095944040982ULL, 1868310774295ULL, 1666447311392ULL, 2001454760419ULL, 2010044695030ULL, 2040109466113ULL, 1958505087492ULL, 1864015807008ULL, 2005749727779ULL, 1812476199436ULL, 1567663063570ULL},
            {1438814044684ULL, 1726576853523ULL, 1773821493779ULL, 1911260447278ULL, 2005749727796ULL, 2014339662371ULL, 1889785610772ULL, 1017907249591ULL, 1795296330232ULL, 1799591297574ULL, 1928440316462ULL, 2022929596991ULL, 2104533975625ULL, 2276332667441ULL, 2052994368042ULL, 1215475745293ULL, 1786706395678ULL, 1924145349172ULL, 2040109466165ULL, 2156073583192ULL, 2254857831001ULL, 2409476653639ULL, 2246267896366ULL, 1632087573036ULL, 1894080578079ULL, 2022929596980ULL, 2126008812116ULL, 2164663517785ULL, 2422361555547ULL, 2396591751758ULL, 2323577307697ULL, 1812476199455ULL, 1894080578083ULL, 2022929596977ULL, 2190433321547ULL, 2254857831007ULL, 2173253452390ULL, 2619930051129ULL, 2126008812072ULL, 2044404433441ULL, 1967095022092ULL, 2061584302632ULL, 2074469204524ULL, 2160368550475ULL, 2392296784477ULL, 2637109920299ULL, 2568390443539ULL, 1623497638399ULL, 1821066134015ULL, 1924145349138ULL, 2052994368032ULL, 2143188681276ULL, 2048699400792ULL, 2345052144172ULL, 1967095022121ULL, 1387274437135ULL, 1640677507586ULL, 1898375545369ULL, 1894080578071ULL, 1975684956704ULL, 2199023256105ULL, 2113123910167ULL, 2113123910135ULL, 1318554960277ULL},
            {0ULL, 365072220339ULL, 356482285736ULL, 369367187637ULL, 433791697104ULL, 562640716017ULL, 369367187666ULL, 0ULL, 0ULL, 442381631678ULL, 420906795188ULL, 472446402751ULL, 545460846798ULL, 631360192769ULL, 519691043019ULL, 0ULL, 0ULL, 485331304646ULL, 523986010296ULL, 571230650555ULL, 631360192710ULL, 889058230486ULL, 489626271972ULL, 0ULL, 0ULL, 459561500876ULL, 541165879493ULL, 670014898362ULL, 661424963766ULL, 863288426674ULL, 695784702113ULL, 0ULL, 0ULL, 558345748697ULL, 618475290819ULL, 687194767544ULL, 798863917235ULL, 923417968811ULL, 584115552416ULL, 0ULL, 0ULL, 717259538621ULL, 601295421624ULL, 644245094584ULL, 755914244280ULL, 1133871366331ULL, 343597383854ULL, 0ULL, 0ULL, 760209211557ULL, 652835029153ULL, 601295421616ULL, 708669604030ULL, 919123001569ULL, 281277408215250ULL, 0ULL, 0ULL, 502511173782ULL, 554050781330ULL, 515396075676ULL, 622770258093ULL, 691489734873ULL, 281144264229089ULL, 0ULL},
    };


    [[nodiscard]] inline packed_eval_t getPassedPawnOnSquareBonus(const int square) {
        return passed_pawn_on_ranks[square & 7] + passed_pawn_on_file[square >> 3];
    }


    [[nodiscard]] inline eval_t getEvalFromPacked (packed_eval_t packed, int phase) { // higher phase means closer to mg
        int mg = int(int16_t(packed >> 32 & 0xffff));
        int eg = int(int16_t(packed & 0xffff));
        return float(mg * phase + eg * (24 - phase)) / 24.0F;
    }
}

namespace pawn_eval {
    constexpr const static bitboard_t WHITE_PAWN_STOPPING_SQUARES[64] = {65278ULL, 64764ULL, 63736ULL, 61680ULL, 57568ULL, 49344ULL, 32896ULL, 0ULL, 16711422ULL, 16579836ULL, 16316664ULL, 15790320ULL, 14737632ULL, 12632256ULL, 8421504ULL, 0ULL, 4278124032ULL, 4244438016ULL, 4177065984ULL, 4042321920ULL, 3772833792ULL, 3233857536ULL, 2155905024ULL, 0ULL, 1095199752192ULL, 1086576132096ULL, 1069328891904ULL, 1034834411520ULL, 965845450752ULL, 827867529216ULL, 551911686144ULL, 0ULL, 280371136561152ULL, 278163489816576ULL, 273748196327424ULL, 264917609349120ULL, 247256435392512ULL, 211934087479296ULL, 141289391652864ULL, 0ULL, 71775010959654912ULL, 71209853393043456ULL, 70079538259820544ULL, 67818907993374720ULL, 63297647460483072ULL, 54255126394699776ULL, 36170084263133184ULL, 0ULL, 18374402805671657472ULL, 18229722468619124736ULL, 17940361794514059264ULL, 17361640446303928320ULL, 16204197749883666432ULL, 13889312357043142656ULL, 9259541571362095104ULL, 0ULL, 18374123529718202368ULL, 18229445391688925184ULL, 17940089115630370816ULL, 17361376563513262080ULL, 16203951459279044608ULL, 13889101250810609664ULL, 9259400833873739776ULL, 0ULL};
    constexpr const static bitboard_t BLACK_PAWN_STOPPING_SQUARES[64] = {0ULL, 257ULL, 771ULL, 1799ULL, 3855ULL, 7967ULL, 16191ULL, 32639ULL, 0ULL, 65793ULL, 197379ULL, 460551ULL, 986895ULL, 2039583ULL, 4144959ULL, 8355711ULL, 0ULL, 16843008ULL, 50529024ULL, 117901056ULL, 252645120ULL, 522133248ULL, 1061109504ULL, 2139062016ULL, 0ULL, 4311810048ULL, 12935430144ULL, 30182670336ULL, 64677150720ULL, 133666111488ULL, 271644033024ULL, 547599876096ULL, 0ULL, 1103823372288ULL, 3311470116864ULL, 7726763606016ULL, 16557350584320ULL, 34218524540928ULL, 69540872454144ULL, 140185568280576ULL, 0ULL, 282578783305728ULL, 847736349917184ULL, 1978051483140096ULL, 4238681749585920ULL, 8759942282477568ULL, 17802463348260864ULL, 35887505479827456ULL, 0ULL, 72340168526266368ULL, 217020505578799104ULL, 506381179683864576ULL, 1085102527893995520ULL, 2242545224314257408ULL, 4557430617154781184ULL, 9187201402835828736ULL, 0ULL, 72339069014638592ULL, 217017207043915776ULL, 506373483102470144ULL, 1085086035219578880ULL, 2242511139453796352ULL, 4557361347922231296ULL, 9187061764859101184ULL};
    constexpr const static bitboard_t PAWN_NEIGHBOR_FILES[8] = {65280ULL,16711935ULL,4278255360ULL,1095233372160ULL,280379743272960ULL,71777214277877760ULL,18374966855136706560ULL,71776119061217280ULL};


    [[nodiscard]] inline bool isThisWhitePawnPassed (const int square, const bitboard_t blackPawns) {
        return (blackPawns & WHITE_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }
    [[nodiscard]] inline bool isThisBlackPawnPassed (const int square, const bitboard_t whitePawns) {
        return (whitePawns & BLACK_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnIsolated (const int square, const bitboard_t friendlyPawns) {
        return (friendlyPawns & PAWN_NEIGHBOR_FILES[square >> 3]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnDoubled (const int square, const int friendlyPawns) {
        return (~(1ULL << square) & friendlyPawns & 255ULL << (square & 56)) != 0ULL;
    }
}