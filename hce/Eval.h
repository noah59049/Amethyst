#pragma once
#include "../Typedefs.h"
namespace hce {
    constexpr int PHASE_PIECE_VALUES[5] = {4,2,1,1,0};
    constexpr const static eval_t MATE_VALUE = 1048576;
    constexpr packed_eval_t bishop_pair = 154618822753ULL;
    constexpr packed_eval_t passed_pawn_on_ranks[] = {0ULL, 281406257299419ULL, 281376192528365ULL, 281376192462865ULL, 51539607608ULL, 30064771216ULL, 592705487106ULL, 0ULL};
    constexpr packed_eval_t passed_pawn_on_file[] = {48ULL, 8589934638ULL, 281466386776099ULL, 17179869200ULL, 281432027037717ULL, 21474836512ULL, 281444911939637ULL, 281453501874227ULL};
    constexpr packed_eval_t king_zone_attacks[] = {103079215124ULL, 167503790069ULL, 133144051703ULL, 94489346037ULL, 90194378732ULL};
    constexpr packed_eval_t mobility[] = {281470681743378ULL, 25769803782ULL, 30064771082ULL, 281470681743362ULL, 281427732135912ULL};
    constexpr packed_eval_t king_psts[] = {219043397534ULL, 347892416471ULL, 281268818345965ULL, 280959580700669ULL, 281002530308106ULL, 280783486976029ULL, 280993940373508ULL, 360777318257ULL, 442381696961ULL, 128849084415ULL, 281427732070412ULL, 281114199457823ULL, 281152854163507ULL, 253403070514ULL, 42949673003ULL, 472446468024ULL, 253403135975ULL, 17179869203ULL, 281131379327018ULL, 280968170569792ULL, 281071249784909ULL, 281311767953486ULL, 281273113247805ULL, 536870977490ULL, 281105609588734ULL, 281268818280483ULL, 281071249784894ULL, 280762012139608ULL, 280774897041506ULL, 281195803836509ULL, 433791696932ULL, 281337537757201ULL, 8590000099ULL, 281268818280489ULL, 281135674294330ULL, 280800666845266ULL, 280847911485535ULL, 281462091808862ULL, 154618822720ULL, 281341832724483ULL, 281281703247869ULL, 281393372332059ULL, 281135674294313ULL, 281054069915702ULL, 281054069915729ULL, 446676598863ULL, 64424509526ULL, 180388626434ULL, 283467907026ULL, 219043397630ULL, 281367602528267ULL, 280972465537065ULL, 281036890046530ULL, 128849018962ULL, 274877907011ULL, 399432024056ULL, 244813201308ULL, 214748430305ULL, 281148559196166ULL, 280573033578529ULL, 280663227891754ULL, 281298883051557ULL, 281320357888028ULL, 579820650344ULL};
    constexpr packed_eval_t piece_type_psts[][64] = {
            {5626407159314ULL, 5647881995799ULL, 5583457486360ULL, 5634997093930ULL, 5570572584508ULL, 5690831668767ULL, 5617817224736ULL, 5458903434781ULL, 5617817224722ULL, 5686536701457ULL, 5643587028512ULL, 5561982649904ULL, 5634997093923ULL, 5673651799569ULL, 5506148075044ULL, 5398773892645ULL, 5712306505235ULL, 5746666243600ULL, 5665061864991ULL, 5596342388250ULL, 5609227290136ULL, 5686536701474ULL, 5506148075076ULL, 5553392715308ULL, 5768141080115ULL, 5776731014689ULL, 5652176963102ULL, 5669356832283ULL, 5592047420960ULL, 5669356832293ULL, 5450313500244ULL, 5708011537935ULL, 5733781341720ULL, 5763846112811ULL, 5677946766893ULL, 5682241734169ULL, 5643587028508ULL, 5720896439848ULL, 5390183958128ULL, 5652176963103ULL, 5630702126607ULL, 5841155524080ULL, 5673651799595ULL, 5634997093924ULL, 5660766897707ULL, 5884105197079ULL, 5656471930422ULL, 5690831668775ULL, 5768141080035ULL, 5854040425934ULL, 5703716570653ULL, 5677946766894ULL, 5686536701515ULL, 5935644804620ULL, 5600637355569ULL, 5995774346713ULL, 5742371276237ULL, 5922759902638ULL, 5673651799588ULL, 5690831668800ULL, 5677946766922ULL, 5841155524141ULL, 5909875000890ULL, 5639292061208ULL},
            {2486786065353ULL, 2353642079176ULL, 2323577308114ULL, 2332167242712ULL, 2409476654048ULL, 2456721294300ULL, 2521145803744ULL, 2589865280477ULL, 2491081032649ULL, 2405181686733ULL, 2323577308110ULL, 2314987373529ULL, 2478196130775ULL, 2611340116954ULL, 2473901163507ULL, 2448131359723ULL, 2572685411279ULL, 2525440771019ULL, 2405181686734ULL, 2370821948379ULL, 2465311228898ULL, 2589865280476ULL, 2589865280504ULL, 2418066588667ULL, 2619930051529ULL, 2516850836430ULL, 2426656523219ULL, 2435246457813ULL, 2521145803738ULL, 2589865280471ULL, 2688649528299ULL, 2400886719478ULL, 2641404888000ULL, 2551210574786ULL, 2452426326984ULL, 2473901163471ULL, 2529735738309ULL, 2796023710659ULL, 2581275345901ULL, 2473901163500ULL, 2598455215041ULL, 2551210574775ULL, 2405181686715ULL, 2310692406223ULL, 2546915607489ULL, 2723009266625ULL, 2727304233947ULL, 2607045149668ULL, 2624225018803ULL, 2645699855272ULL, 2564095476637ULL, 2452426326976ULL, 2589865280449ULL, 3015067042742ULL, 2701534430163ULL, 2589865280483ULL, 2499670967221ULL, 2452426326964ULL, 2478196130727ULL, 2409476654013ULL, 2611340116923ULL, 2813203579828ULL, 2894807958466ULL, 2787433776084ULL},
            {1821066133995ULL, 1881195676161ULL, 1842540970494ULL, 1821066134017ULL, 1825361101320ULL, 1881195676173ULL, 1769526526454ULL, 1713691951621ULL, 1954210120195ULL, 1962800054770ULL, 1859720839679ULL, 1799591297542ULL, 1898375545349ULL, 2010044695035ULL, 1924145349111ULL, 1554778161683ULL, 1902670512630ULL, 1975684956653ULL, 1924145349121ULL, 1833951035912ULL, 1932735283710ULL, 1971389989371ULL, 1855425872382ULL, 1541893259788ULL, 1838246003199ULL, 1872605741574ULL, 1894080578053ULL, 2001454760447ULL, 1997159793160ULL, 1997159793135ULL, 1748051689986ULL, 1279900254750ULL, 1872605741567ULL, 1949915152897ULL, 1924145349128ULL, 1962800054779ULL, 1988569858552ULL, 1906965479927ULL, 1851130905079ULL, 1348619731479ULL, 1855425872390ULL, 2018634629622ULL, 1924145349119ULL, 1872605741565ULL, 1954210120192ULL, 2138893713915ULL, 1846835937785ULL, 1430224110089ULL, 1958505087466ULL, 2083059139065ULL, 1881195676146ULL, 1838246003201ULL, 1902670512638ULL, 2027224564222ULL, 1791001362945ULL, 1636382540295ULL, 1915555414480ULL, 1941325218277ULL, 1967095022062ULL, 1885490643441ULL, 1782411428362ULL, 1919850381842ULL, 1769526526451ULL, 1494648619518ULL},
            {1348619731453ULL, 1657857376776ULL, 1713691951624ULL, 1842540970530ULL, 1924145349157ULL, 1924145349139ULL, 1795296330242ULL, 953482740146ULL, 1760936591858ULL, 1739461755419ULL, 1855425872417ULL, 1945620185649ULL, 2031519531581ULL, 2190433321509ULL, 1949915152925ULL, 1146756268545ULL, 1705102017043ULL, 1859720839722ULL, 1988569858603ULL, 2087354106445ULL, 2177548419660ULL, 2319282340412ULL, 2138893713959ULL, 1559073128994ULL, 1825361101332ULL, 1975684956717ULL, 2052994368075ULL, 2100239008334ULL, 2353642078797ULL, 2310692405826ULL, 2216203125291ULL, 1752346657301ULL, 1825361101337ULL, 1971389989419ULL, 2117418877504ULL, 2186138354261ULL, 2117418877528ULL, 2512555868719ULL, 2070174237219ULL, 1975684956698ULL, 1906965479939ULL, 2001454760480ULL, 2022929596961ULL, 2095944041022ULL, 2323577307726ULL, 2572685410847ULL, 2482491097609ULL, 1597727834615ULL, 1786706395641ULL, 1855425872393ULL, 1971389989395ULL, 2065879269933ULL, 1988569858633ULL, 2259152798241ULL, 1932735283737ULL, 1352914698760ULL, 1550483194351ULL, 1842540970513ULL, 1833951035913ULL, 1906965479955ULL, 2113123910172ULL, 2061584302602ULL, 2031519531500ULL, 1262720385423ULL},
            {0ULL, 399431958723ULL, 373662154933ULL, 382252089539ULL, 442381631708ULL, 558345748733ULL, 360777253069ULL, 0ULL, 0ULL, 554050781410ULL, 502511173840ULL, 575525617886ULL, 627065225450ULL, 700079669533ULL, 575525617877ULL, 0ULL, 0ULL, 502511173845ULL, 519691043012ULL, 575525617865ULL, 627065225428ULL, 863288426725ULL, 459561500895ULL, 0ULL, 0ULL, 468151435486ULL, 536870912211ULL, 665719931080ULL, 652835029190ULL, 837518622916ULL, 657129996448ULL, 0ULL, 0ULL, 575525617896ULL, 614180323536ULL, 695784702152ULL, 790273982659ULL, 897648165054ULL, 541165879456ULL, 0ULL, 0ULL, 721554505935ULL, 584115552454ULL, 639950127304ULL, 743029342409ULL, 1103806595279ULL, 347892351147ULL, 0ULL, 0ULL, 858993459401ULL, 712964571327ULL, 682899800272ULL, 777389080795ULL, 957777707260ULL, 281333242790107ULL, 0ULL, 0ULL, 511101108387ULL, 545460846748ULL, 498216206503ULL, 605590388922ULL, 648540061926ULL, 281127084359896ULL, 0ULL},
    };

    [[nodiscard]] inline packed_eval_t getPassedPawnOnSquareBonus(const int square) {
        return passed_pawn_on_ranks[square & 7] + passed_pawn_on_file[square >> 3];
    }


    [[nodiscard]] inline eval_t getEvalFromPacked (packed_eval_t packed, int phase) { // higher phase means closer to mg
        int mg = int(int16_t(packed >> 32 & 0xffff));
        int eg = int(int16_t(packed & 0xffff));
        return float(mg * phase + eg * (24 - phase)) / 24.0F;
    }
};

namespace pawn_eval {
    constexpr const static bitboard_t WHITE_PAWN_STOPPING_SQUARES[64] = {65278ULL, 64764ULL, 63736ULL, 61680ULL, 57568ULL, 49344ULL, 32896ULL, 0ULL, 16711422ULL, 16579836ULL, 16316664ULL, 15790320ULL, 14737632ULL, 12632256ULL, 8421504ULL, 0ULL, 4278124032ULL, 4244438016ULL, 4177065984ULL, 4042321920ULL, 3772833792ULL, 3233857536ULL, 2155905024ULL, 0ULL, 1095199752192ULL, 1086576132096ULL, 1069328891904ULL, 1034834411520ULL, 965845450752ULL, 827867529216ULL, 551911686144ULL, 0ULL, 280371136561152ULL, 278163489816576ULL, 273748196327424ULL, 264917609349120ULL, 247256435392512ULL, 211934087479296ULL, 141289391652864ULL, 0ULL, 71775010959654912ULL, 71209853393043456ULL, 70079538259820544ULL, 67818907993374720ULL, 63297647460483072ULL, 54255126394699776ULL, 36170084263133184ULL, 0ULL, 18374402805671657472ULL, 18229722468619124736ULL, 17940361794514059264ULL, 17361640446303928320ULL, 16204197749883666432ULL, 13889312357043142656ULL, 9259541571362095104ULL, 0ULL, 18374123529718202368ULL, 18229445391688925184ULL, 17940089115630370816ULL, 17361376563513262080ULL, 16203951459279044608ULL, 13889101250810609664ULL, 9259400833873739776ULL, 0ULL};
    constexpr const static bitboard_t BLACK_PAWN_STOPPING_SQUARES[64] = {0ULL, 257ULL, 771ULL, 1799ULL, 3855ULL, 7967ULL, 16191ULL, 32639ULL, 0ULL, 65793ULL, 197379ULL, 460551ULL, 986895ULL, 2039583ULL, 4144959ULL, 8355711ULL, 0ULL, 16843008ULL, 50529024ULL, 117901056ULL, 252645120ULL, 522133248ULL, 1061109504ULL, 2139062016ULL, 0ULL, 4311810048ULL, 12935430144ULL, 30182670336ULL, 64677150720ULL, 133666111488ULL, 271644033024ULL, 547599876096ULL, 0ULL, 1103823372288ULL, 3311470116864ULL, 7726763606016ULL, 16557350584320ULL, 34218524540928ULL, 69540872454144ULL, 140185568280576ULL, 0ULL, 282578783305728ULL, 847736349917184ULL, 1978051483140096ULL, 4238681749585920ULL, 8759942282477568ULL, 17802463348260864ULL, 35887505479827456ULL, 0ULL, 72340168526266368ULL, 217020505578799104ULL, 506381179683864576ULL, 1085102527893995520ULL, 2242545224314257408ULL, 4557430617154781184ULL, 9187201402835828736ULL, 0ULL, 72339069014638592ULL, 217017207043915776ULL, 506373483102470144ULL, 1085086035219578880ULL, 2242511139453796352ULL, 4557361347922231296ULL, 9187061764859101184ULL};

    [[nodiscard]] inline bool isThisWhitePawnPassed (const int square, const bitboard_t blackPawns) {
        return (blackPawns & WHITE_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }
    [[nodiscard]] inline bool isThisBlackPawnPassed (const int square, const bitboard_t whitePawns) {
        return (whitePawns & BLACK_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }
}