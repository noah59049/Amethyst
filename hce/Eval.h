#pragma once
#include "../Typedefs.h"
namespace hce {
    constexpr int PHASE_PIECE_VALUES[5] = {4,2,1,1,0};
    constexpr const static eval_t MATE_VALUE = 1048576;
    constexpr uint64_t bishop_pair = 158913790050ULL;
    constexpr uint64_t passed_pawn_on_ranks[] = {0ULL, 281440617037795ULL, 281410552266740ULL, 281414847168538ULL, 81604378687ULL, 47244640408ULL, 566935683324ULL, 0ULL};
    constexpr uint64_t passed_pawn_on_file[] = {85899345982ULL, 81604378685ULL, 281462091808805ULL, 17179869200ULL, 281419142135829ULL, 8589934627ULL, 12884901955ULL, 38654705725ULL};
    constexpr uint64_t isolated_pawn = 281363307626476ULL;
    constexpr uint64_t king_zone_attacks[] = {107374182420ULL, 171798757365ULL, 133144051704ULL, 94489346037ULL, 94489346029ULL};
    constexpr uint64_t mobility[] = {281470681743378ULL, 25769803782ULL, 30064771082ULL, 3ULL, 281436322070514ULL};
    constexpr uint64_t king_psts[] = {227633332126ULL, 343597449173ULL, 281268818345964ULL, 280963875667964ULL, 281028300111881ULL, 280796371877918ULL, 280993940373511ULL, 360777318259ULL, 442381696959ULL, 133144051710ULL, 281444911939596ULL, 281131379327008ULL, 281161444098100ULL, 261993005108ULL, 47244640300ULL, 463856533434ULL, 253403135973ULL, 17179869202ULL, 281148559196202ULL, 280985350438976ULL, 281071249784911ULL, 281294588084304ULL, 281255933378623ULL, 532576010195ULL, 281105609588733ULL, 281264523313186ULL, 281079839719485ULL, 280779192008792ULL, 280783486976099ULL, 281212983705694ULL, 429496729639ULL, 281341832724498ULL, 4295032803ULL, 281264523313192ULL, 281139969261626ULL, 280809256779859ULL, 280856501420129ULL, 281470681743457ULL, 158913790018ULL, 281359012593669ULL, 281277408280572ULL, 281389077364762ULL, 281144264228906ULL, 281062659850296ULL, 281066954817620ULL, 463856468049ULL, 98784247896ULL, 201863462915ULL, 279172939729ULL, 206158495742ULL, 281367602528270ULL, 280968170569771ULL, 281045479981125ULL, 154618822740ULL, 296352743494ULL, 408021958652ULL, 244813201308ULL, 206158495713ULL, 281139969261575ULL, 280573033578530ULL, 280676112793643ULL, 281298883051559ULL, 281320357888032ULL, 605590454125ULL};
    constexpr uint64_t piece_type_psts[][64] = {
            {5669356832281ULL, 5686536701467ULL, 5639292061212ULL, 5677946766897ULL, 5609227290181ULL, 5725191407144ULL, 5660766897705ULL, 5493263173157ULL, 5665061864985ULL, 5729486374423ULL, 5695126636074ULL, 5613522257463ULL, 5677946766893ULL, 5708011537948ULL, 5523327944240ULL, 5437428598317ULL, 5759551145498ULL, 5793910883863ULL, 5712306505256ULL, 5639292061221ULL, 5656471930401ULL, 5716601472556ULL, 5536212846160ULL, 5579162519093ULL, 5815385720378ULL, 5819680687657ULL, 5703716570662ULL, 5712306505254ULL, 5639292061227ULL, 5708011537967ULL, 5471788336738ULL, 5750961210902ULL, 5781025981983ULL, 5806795785778ULL, 5729486374455ULL, 5725191407140ULL, 5686536701480ULL, 5759551145522ULL, 5424543696508ULL, 5690831668773ULL, 5677946766869ULL, 5884105197048ULL, 5729486374453ULL, 5677946766896ULL, 5699421603380ULL, 5914169968162ULL, 5686536701503ULL, 5729486374447ULL, 5819680687595ULL, 5901285066196ULL, 5763846112808ULL, 5725191407161ULL, 5733781341782ULL, 5974299510292ULL, 5617817224764ULL, 6030134085093ULL, 5781025981909ULL, 5965709575603ULL, 5725191407149ULL, 5733781341772ULL, 5716601472595ULL, 5884105197109ULL, 5957119641154ULL, 5656471930404ULL},
            {2508260901835ULL, 2375116915658ULL, 2349347111894ULL, 2353642079197ULL, 2448131359715ULL, 2503965934558ULL, 2546915607523ULL, 2598455215073ULL, 2521145803724ULL, 2430951490511ULL, 2362232013778ULL, 2345052144606ULL, 2503965934556ULL, 2641404888029ULL, 2486786065398ULL, 2465311228911ULL, 2598455215057ULL, 2546915607501ULL, 2435246457808ULL, 2405181686751ULL, 2499670967270ULL, 2615635084255ULL, 2602750182396ULL, 2439541425150ULL, 2649994822602ULL, 2542620640208ULL, 2456721294293ULL, 2469606196185ULL, 2555505542110ULL, 2611340116954ULL, 2705829397487ULL, 2418066588665ULL, 2667174691778ULL, 2576980378564ULL, 2491081032651ULL, 2503965934547ULL, 2555505542090ULL, 2821793514439ULL, 2598455215088ULL, 2482491098096ULL, 2624225018819ULL, 2581275345849ULL, 2443836392383ULL, 2345052144597ULL, 2572685411270ULL, 2753074037700ULL, 2740189135838ULL, 2611340116968ULL, 2658584757174ULL, 2675764626345ULL, 2607045149602ULL, 2495375999940ULL, 2615635084230ULL, 3049426781113ULL, 2710124364760ULL, 2594160247784ULL, 2521145803703ULL, 2469606196150ULL, 2512555869099ULL, 2439541425090ULL, 2632814953408ULL, 2847563318200ULL, 2916282794950ULL, 2791728743385ULL},
            {1838246003186ULL, 1906965479947ULL, 1864015806984ULL, 1846835937802ULL, 1842540970513ULL, 1902670512661ULL, 1795296330237ULL, 1717986918926ULL, 1988569858570ULL, 1979979923961ULL, 1894080578062ULL, 1821066134035ULL, 1924145349138ULL, 2027224564231ULL, 1915555414530ULL, 1567663063579ULL, 1919850381821ULL, 2001454760439ULL, 1945620185614ULL, 1859720839701ULL, 1949915152908ULL, 1988569858568ULL, 1864015806985ULL, 1554778161684ULL, 1864015806983ULL, 1889785610766ULL, 1919850381842ULL, 2027224564238ULL, 2022929596951ULL, 2018634629628ULL, 1765231559181ULL, 1297080123942ULL, 1894080578054ULL, 1971389989386ULL, 1949915152918ULL, 1992864825865ULL, 2010044695046ULL, 1928440316420ULL, 1868310774272ULL, 1357209666080ULL, 1881195676174ULL, 2035814498815ULL, 1954210120204ULL, 1894080578059ULL, 1967095022094ULL, 2151778615816ULL, 1855425872388ULL, 1438814044689ULL, 1975684956657ULL, 2095944040962ULL, 1919850381825ULL, 1859720839693ULL, 1919850381833ULL, 2044404433417ULL, 1773821493771ULL, 1640677507601ULL, 1937030250967ULL, 1962800054765ULL, 1988569858552ULL, 1911260447225ULL, 1799591297555ULL, 1945620185625ULL, 1795296330234ULL, 1490353652230ULL},
            {1382979469822ULL, 1683627180553ULL, 1739461755403ULL, 1868310774308ULL, 1949915152935ULL, 1941325218324ULL, 1812476199427ULL, 953482740146ULL, 1778116461041ULL, 1756641624603ULL, 1885490643493ULL, 1971389989427ULL, 2048699400765ULL, 2207613190693ULL, 1945620185630ULL, 1138166333957ULL, 1735166788115ULL, 1881195676202ULL, 2014339662380ULL, 2108828942925ULL, 2203318223437ULL, 2332167242299ULL, 2143188681253ULL, 1567663063586ULL, 1846835937812ULL, 1992864825900ULL, 2078764171850ULL, 2121713844814ULL, 2375116915278ULL, 2332167242306ULL, 2233382994474ULL, 1752346657302ULL, 1851130905113ULL, 1988569858601ULL, 2143188681281ULL, 2207613190741ULL, 2143188681304ULL, 2525440770606ULL, 2078764171811ULL, 1979979923995ULL, 1928440316419ULL, 2018634629663ULL, 2048699400739ULL, 2121713844800ULL, 2345052144207ULL, 2594160247326ULL, 2482491097608ULL, 1589137900025ULL, 1803886264825ULL, 1881195676170ULL, 2005749727768ULL, 2095944041008ULL, 2005749727818ULL, 2276332667424ULL, 1928440316442ULL, 1331439862283ULL, 1571958030835ULL, 1859720839698ULL, 1859720839694ULL, 1928440316438ULL, 2138893713948ULL, 2083059139082ULL, 2044404433388ULL, 1254130450834ULL},
            {0ULL, 347892351152ULL, 326417514661ULL, 335007449265ULL, 399431958732ULL, 519691043054ULL, 356482285774ULL, 0ULL, 0ULL, 416611827900ULL, 382252089520ULL, 442381631675ULL, 506806141131ULL, 588410519807ULL, 485331304645ULL, 0ULL, 0ULL, 468151435460ULL, 498216206517ULL, 541165879480ULL, 601295421636ULL, 841813590230ULL, 476741370079ULL, 0ULL, 0ULL, 438086664396ULL, 515396075715ULL, 644245094584ULL, 627065225397ULL, 820338753714ULL, 695784702111ULL, 0ULL, 0ULL, 541165879511ULL, 588410519745ULL, 665719931062ULL, 764504178866ULL, 876173328556ULL, 566935683231ULL, 0ULL, 0ULL, 695784702139ULL, 575525617846ULL, 614180323509ULL, 721554505909ULL, 1082331758779ULL, 356482285736ULL, 0ULL, 0ULL, 734439407778ULL, 614180323486ULL, 562640715949ULL, 665719931067ULL, 871878361309ULL, 281243048476877ULL, 0ULL, 0ULL, 485331304596ULL, 528280977551ULL, 481036337304ULL, 588410519723ULL, 639950127320ULL, 281139969261788ULL, 0ULL},
    };


    [[nodiscard]] inline packed_eval_t getPassedPawnOnSquareBonus(const int square) {
        return passed_pawn_on_ranks[square & 7] + passed_pawn_on_file[square >> 3];
    }


    [[nodiscard]] inline eval_t getEvalFromPacked (packed_eval_t packed, int phase) { // higher phase means closer to mg
        int mg = int(int16_t(packed >> 32 & 0xffff));
        int eg = int(int16_t(packed & 0xffff));
        return float(mg * phase + eg * (24 - phase)) / 24.0F;
    }
};

namespace pawn_eval {
    constexpr const static bitboard_t WHITE_PAWN_STOPPING_SQUARES[64] = {65278ULL, 64764ULL, 63736ULL, 61680ULL, 57568ULL, 49344ULL, 32896ULL, 0ULL, 16711422ULL, 16579836ULL, 16316664ULL, 15790320ULL, 14737632ULL, 12632256ULL, 8421504ULL, 0ULL, 4278124032ULL, 4244438016ULL, 4177065984ULL, 4042321920ULL, 3772833792ULL, 3233857536ULL, 2155905024ULL, 0ULL, 1095199752192ULL, 1086576132096ULL, 1069328891904ULL, 1034834411520ULL, 965845450752ULL, 827867529216ULL, 551911686144ULL, 0ULL, 280371136561152ULL, 278163489816576ULL, 273748196327424ULL, 264917609349120ULL, 247256435392512ULL, 211934087479296ULL, 141289391652864ULL, 0ULL, 71775010959654912ULL, 71209853393043456ULL, 70079538259820544ULL, 67818907993374720ULL, 63297647460483072ULL, 54255126394699776ULL, 36170084263133184ULL, 0ULL, 18374402805671657472ULL, 18229722468619124736ULL, 17940361794514059264ULL, 17361640446303928320ULL, 16204197749883666432ULL, 13889312357043142656ULL, 9259541571362095104ULL, 0ULL, 18374123529718202368ULL, 18229445391688925184ULL, 17940089115630370816ULL, 17361376563513262080ULL, 16203951459279044608ULL, 13889101250810609664ULL, 9259400833873739776ULL, 0ULL};
    constexpr const static bitboard_t BLACK_PAWN_STOPPING_SQUARES[64] = {0ULL, 257ULL, 771ULL, 1799ULL, 3855ULL, 7967ULL, 16191ULL, 32639ULL, 0ULL, 65793ULL, 197379ULL, 460551ULL, 986895ULL, 2039583ULL, 4144959ULL, 8355711ULL, 0ULL, 16843008ULL, 50529024ULL, 117901056ULL, 252645120ULL, 522133248ULL, 1061109504ULL, 2139062016ULL, 0ULL, 4311810048ULL, 12935430144ULL, 30182670336ULL, 64677150720ULL, 133666111488ULL, 271644033024ULL, 547599876096ULL, 0ULL, 1103823372288ULL, 3311470116864ULL, 7726763606016ULL, 16557350584320ULL, 34218524540928ULL, 69540872454144ULL, 140185568280576ULL, 0ULL, 282578783305728ULL, 847736349917184ULL, 1978051483140096ULL, 4238681749585920ULL, 8759942282477568ULL, 17802463348260864ULL, 35887505479827456ULL, 0ULL, 72340168526266368ULL, 217020505578799104ULL, 506381179683864576ULL, 1085102527893995520ULL, 2242545224314257408ULL, 4557430617154781184ULL, 9187201402835828736ULL, 0ULL, 72339069014638592ULL, 217017207043915776ULL, 506373483102470144ULL, 1085086035219578880ULL, 2242511139453796352ULL, 4557361347922231296ULL, 9187061764859101184ULL};
    constexpr const static bitboard_t PAWN_NEIGHBOR_FILES[8] = {65280ULL,16711935ULL,4278255360ULL,1095233372160ULL,280379743272960ULL,71777214277877760ULL,18374966855136706560ULL,71776119061217280ULL};


    [[nodiscard]] inline bool isThisWhitePawnPassed (const int square, const bitboard_t blackPawns) {
        return (blackPawns & WHITE_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }
    [[nodiscard]] inline bool isThisBlackPawnPassed (const int square, const bitboard_t whitePawns) {
        return (whitePawns & BLACK_PAWN_STOPPING_SQUARES[square]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnIsolated (const int square, const bitboard_t friendlyPawns) {
        return (friendlyPawns & PAWN_NEIGHBOR_FILES[square >> 3]) == 0ULL;
    }

    [[nodiscard]] inline bool isThisPawnDoubled (const int square, const int friendlyPawns) {
        return (~(1ULL << square) & friendlyPawns & 255ULL << (square & 56)) != 0ULL;
    }
}